link(rel="import" href="/components/bower/polymer/polymer.html")
link(rel="import" href="/components/bower/iron-icons/iron-icons.html")

link(rel="import" href="/components/3rdparty/lodash.html")
link(rel="import" href="/components/3rdparty/web3.html")
link(rel="import" href="/components/api/api.html")
link(rel="import" href="/components/datetime/datetime.html")
link(rel="import" href="/components/number/number.html")
link(rel="import" href="/components/page/page.html")
link(rel="import" href="/components/pubsub/pubsub.html")
  
dom-module#xyz-game-lottery
  template
    style !{readCompiled('lottery.css')}
    
    xyz-api#api
    xyz-pubsub#pubsub
    
    xyz-page-section.hidden(color="blue-dark" opacity class$="[[visibleClass(current, 'round')]]")
      .stats
        .round
          .large {{current.round}}
          .normal rounds
        .time
          .large
            xyz-datetime-countdown(datetime="{{current.end}}" format="(long)")
          .normal time remaining
        .pool
          .large {{current.poolval}}
          .normal {{current.poolunit}}
        
    xyz-page-section(color="blue-dark" opacity size="small" shadow)
      .hidden(class$="[[visibleClass(config, 'price')]]")
        .contract.right
          xyz-number-wei(number="{{config.min}}")
          span &nbsp;-&nbsp;
          xyz-number-wei(number="{{config.max}}")
          iron-icon(icon="icons:input")
          span {{config.addr}}
          
    xyz-page-section.hidden(color="green" size="small" class$="[[visibleClass(winner, 'round')]]")
      .center.winner
        iron-icon(icon="icons:donut-large")
        span round {{winner.round}}
        iron-icon(icon="icons:account-balance")
        xyz-number-wei(number="{{winner.value}}")
        iron-icon(icon="icons:trending-flat")
        iron-icon(icon="icons:perm-identity")
        span {{winner.addr}}
        iron-icon(icon="icons:history")
        xyz-datetime-elapsed(datetime="{{winner.at}}")
      
    xyz-page-section.hidden(class$="[[visibleClass(config, 'price')]]")
      .about(color="gray")
        h2 about
        p.
          Send multiple tickets (one ticket equals the minimum fee), and each ticket gives you one chance to <span class="bold">win the overall available pool</span> at the end of the draw.
        p.
          The more transactions sent, the larger the pool becomes (<span class="bold">maximizing the winnings</span>), however it also means there are a larger the number of opposition (<span class="bold">minimizing the chances</span>).
        p.
          The most looney way to try and make a large fortune from a small one.
      
      .entries
        //h2 recent players
        table: tbody: template(is="dom-repeat" items="{{players}}")
          tr.entry
            td.addr(colspan="3")
              iron-icon(icon="icons:perm-identity")
              span {{item.addr}}
            td.max(rowspan="2")
              a(href$="https://etherscan.io/tx/{{item.txhash}}" target="_blank")
                iron-icon(icon="icons:open-in-new")
                span etherscan
            td.when(rowspan="2")
              iron-icon(icon="icons:history")
              xyz-datetime-elapsed(datetime="{{item.at}}")
          tr.data
            td.value
              iron-icon(icon="icons:input")
              xyz-number-wei(number="{{item.value}}")
            td.round
              iron-icon(icon="icons:donut-large")
              span round {{item.round}}
            td.tickets
              iron-icon(icon="icons:content-copy")
              span {{item.tickets}} tickets
            
    xyz-page-section.hidden(color="gray" opacity class$="[[visibleClass(config, 'price')]]")
      h2 operation and rules
      ol
        li To enter, send between <xyz-number-wei number="{{config.min}}" class="bold"></xyz-number-wei> and <xyz-number-wei number="{{config.max}}" class="bold"></xyz-number-wei> to <span class="bold">{{config.addr}}</span>
        li There is only <span class="bold">one winner per round</span>, the randomly selected address collects the full pool minus the applicable commission
        li Every <xyz-number-wei number="{{config.price}}" class="bold"></xyz-number-wei> you send (an entry) buys one ticket, any value not a multiple of this will be returned
        li You can <span class="bold">enter as many times</span> as you like, with as many tickets per entry as you like
        li Tickets are automatically <span class="bold">allocated based on the value</span> you have sent
        li The game will finish a round when the timer expires and <span class="bold">at least {{config.minentries}} entries</span> are made
        li When <span class="bold">the maxiumum {{config.maxentries}} entries/transactions</span> are received the round will finish, regardless of the number of tickets per entry or time elapsed
        li The game operates on a <span class="bold">{{config.edge}}% commission</span>, this is subtracted from the amount paid to the winner at the end of each round
        
  script !{readCompiled('lottery.js')}
